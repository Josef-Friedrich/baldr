<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: vue-plugin-shortcuts/src/main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: vue-plugin-shortcuts/src/main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Wrapper functions around {@link https://craig.is/killing/mice mousetrap}.
 *
 * A instance of the class {@link module:@bldr/vue-plugin-shortcuts~Shortcuts Shortcuts} is mounted
 *   under `this.$shortcuts` in the Vue apps.
 * @module @bldr/vue-plugin-shortcuts
 */

import Mousetrap from 'mousetrap'
import Vue from 'vue'
import ShortcutsOverview from './ShortcutsOverview.vue'

/**
 * @typedef {Object} shortcutSpec
 * @property {String} shortcutSpec.keys - Mousetrap key specification, see the
 *   {@link https://craig.is/killing/mice documentation}.
 * @property {Function} shortcutSpec.callback - A callback function.
 * @property {String} shortcutSpec.description - Some text to describe the
 *   shortcut.
 * @property {Array} shortcutSpec.routeNames - A list of route names.
 *   Activate this shortcut only on this routes.
 */

// https://github.com/ccampbell/mousetrap/blob/master/plugins/pause/mousetrap-pause.js

var _originalStopCallback = Mousetrap.prototype.stopCallback

Mousetrap.prototype.stopCallback = function (e, element, combo) {
  var self = this

  if (self.paused) {
    return true
  }

  return _originalStopCallback.call(self, e, element, combo)
}

Mousetrap.prototype.pause = function () {
  var self = this
  self.paused = true
}

Mousetrap.prototype.unpause = function () {
  var self = this
  self.paused = false
}

Mousetrap.init()

const state = {}

const getters = {
  all: (state) => {
    return state
  }
}

const mutations = {
  add (state, shortcut) {
    // if (shortcut.keys in state) {
    //   throw new Error(`Keyboard shortcut “${shortcut.keys}” “${shortcut.description}” already taken.`)
    // }
    Vue.set(state, shortcut.keys, shortcut)
  },
  remove (state, keys) {
    Vue.delete(state, keys)
  }
}

const storeModule = {
  namespaced: true,
  state,
  getters,
  mutations
}

/**
 * This class is mounted under `this.$shortcuts`
 */
class Shortcuts {
  constructor (router, store) {
    /**
     * A {@link https://router.vuejs.org/ vue router instance.}
     *
     * @type {Object}
     */
    this.$router = router

    /**
     * A {@link https://vuex.vuejs.org/ vuex store instance.}
     *
     * @type {Object}
     */
    this.$store = store

    if (this.$router) {
      const route = {
        path: '/shortcuts',
        meta: {
          shortcut: 'ctrl+h'
        },
        // shortcuts
        name: 'Tastenkürzel',
        component: ShortcutsOverview
      }
      this.addRoute(route)
      this.fromRoutes()
    }
  }

  /**
   * Add a shortcut.
   *
   * @param {String} keys - Mousetrap key specification, see the
   *   {@link https://craig.is/killing/mice documentation}.
   * @param {Function} callback - A callback function.
   * @param {String} description - Some text to describe the shortcut.
   * @param {Array} routeNames - A list of route names. Activate this
   *   shortcut only on this routes.
   */
  add (keys, callback, description, routeNames) {
    const prevent = () => {
      if (routeNames) {
        if (routeNames.includes(this.$router.currentRoute.name)) {
          callback()
        }
      } else {
        callback()
      }

      // Prevent default
      // As a convenience you can also return false in your callback:
      return false
    }
    Mousetrap.bind(keys, prevent)
    if (this.$store) this.$store.commit('shortcuts/add', { keys, description })
  }

  /**
   * A multiple shortcuts
   *
   * @param {array} shortcutSpecs - An array of
   *   {@link module:@bldr/vue-plugin-shortcuts~shortcutSpec shortcutSpec s}.
   */
  addMultiple (shortcutSpecs) {
    for (const shortcut of shortcutSpecs) {
      this.add(
        shortcut.keys,
        shortcut.callback,
        shortcut.description,
        shortcut.routeNames
      )
    }
  }

  /**
   *
   * @param {Object} keys
   */
  remove (keys) {
    Mousetrap.unbind(keys)
    if (this.$store) this.$store.commit('shortcuts/remove', keys)
  }

  /**
   *
   * @param {Object} route
   */
  addRoute (route) {
    this.$router.addRoutes([route])
    this.$router.options.routes.push(route)
  }

  /**
   * @param {Object} route
   */
  fromRoute (route) {
    if ('meta' in route &amp;&amp; 'shortcut' in route.meta) {
      let routeTitle
      if ('title' in route.meta) {
        routeTitle = route.meta.title
      } else if ('name' in route) {
        routeTitle = route.name
      } else {
        routeTitle = route.path
      }
      let key
      if (route.meta.shortcut.length === 1) {
        key = `g ${route.meta.shortcut}`
      } else {
        key = route.meta.shortcut
      }
      this.add(
        key,
        () => {
          // To avoid uncaught exception object when navigation to a already
          // loaded route.
          if (this.$router.currentRoute.path !== route.path) {
            this.$router.push(route.path)
          }
        },
        // `Go to route: ${routeTitle}`
        `Gehe zu: „${routeTitle}“`
      )
    }
  }

  /**
   * @param {object} router - The router object of the Vue router (this.$router)
   */
  fromRoutes () {
    for (const route of this.$router.options.routes) {
      this.fromRoute(route)
    }
  }

  /**
   *
   */
  pause () {
    Mousetrap.pause()
  }

  /**
   *
   */
  unpause () {
    Mousetrap.unpause()
  }
}

// https://stackoverflow.com/a/56501461
// Vue.use(shortcuts, router, store)
const Plugin = {
  install (Vue, router, store) {
    if (!router) throw new Error('Pass in an instance of “VueRouter”.')
    if (store) store.registerModule('shortcuts', storeModule)
    /**
     * $shortcuts
     * @memberof module:@bldr/vue-app-presentation~Vue
     * @type {module:@bldr/vue-plugin-shortcuts~Shortcuts}
     */
    Vue.prototype.$shortcuts = new Shortcuts(router, store)
  }
}

export default Plugin
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-@bldr_api.html">@bldr/api</a></li><li><a href="module-@bldr_api-media-server.html">@bldr/api-media-server</a></li><li><a href="module-@bldr_api-seating-plan.html">@bldr/api-seating-plan</a></li><li><a href="module-@bldr_core-browser.html">@bldr/core-browser</a></li><li><a href="module-@bldr_core-node.html">@bldr/core-node</a></li><li><a href="module-@bldr_http-request.html">@bldr/http-request</a></li><li><a href="module-@bldr_songbook-cli.html">@bldr/songbook-cli</a></li><li><a href="module-@bldr_songbook-core.html">@bldr/songbook-core</a></li><li><a href="module-@bldr_songbook-intermediate-files.html">@bldr/songbook-intermediate-files</a></li><li><a href="module-@bldr_themes.html">@bldr/themes</a></li><li><a href="module-@bldr_vue-app-presentation.html">@bldr/vue-app-presentation</a></li><li><a href="module-@bldr_vue-app-presentation_masters.html">@bldr/vue-app-presentation/masters</a></li><li><a href="module-@bldr_vue-app-seating-plan.html">@bldr/vue-app-seating-plan</a></li><li><a href="module-@bldr_vue-app-showroom.html">@bldr/vue-app-showroom</a></li><li><a href="module-@bldr_vue-app-songbook.html">@bldr/vue-app-songbook</a></li><li><a href="module-@bldr_vue-plugin-components-collection.html">@bldr/vue-plugin-components-collection</a></li><li><a href="module-@bldr_vue-plugin-material-icon.html">@bldr/vue-plugin-material-icon</a></li><li><a href="module-@bldr_vue-plugin-media.html">@bldr/vue-plugin-media</a></li><li><a href="module-@bldr_vue-plugin-shortcuts.html">@bldr/vue-plugin-shortcuts</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-@bldr_vue-app-presentation-Vue.html">Vue</a></li></ul><h3>Classes</h3><ul><li><a href="InitState.html">InitState</a></li><li><a href="MetaData.html">MetaData</a></li><li><a href="module-@bldr_api-media-server-Asset.html">Asset</a></li><li><a href="module-@bldr_api-media-server-AssetTypes.html">AssetTypes</a></li><li><a href="module-@bldr_api-media-server-MediaFile.html">MediaFile</a></li><li><a href="module-@bldr_api-media-server-Presentation.html">Presentation</a></li><li><a href="module-@bldr_http-request.HttpRequest.html">HttpRequest</a></li><li><a href="module-@bldr_songbook-core-AlphabeticalSongsTree.html">AlphabeticalSongsTree</a></li><li><a href="module-@bldr_songbook-core-CoreLibrary.html">CoreLibrary</a></li><li><a href="module-@bldr_songbook-core-SongMetaDataCombined.html">SongMetaDataCombined</a></li><li><a href="module-@bldr_songbook-intermediate-files-FileMonitor.html">FileMonitor</a></li><li><a href="module-@bldr_songbook-intermediate-files-Folder.html">Folder</a></li><li><a href="module-@bldr_songbook-intermediate-files-IntermediateLibrary.html">IntermediateLibrary</a></li><li><a href="module-@bldr_songbook-intermediate-files-IntermediateSong.html">IntermediateSong</a></li><li><a href="module-@bldr_songbook-intermediate-files-Library.html">Library</a></li><li><a href="module-@bldr_songbook-intermediate-files-PianoFilesCountTree.html">PianoFilesCountTree</a></li><li><a href="module-@bldr_songbook-intermediate-files-PianoScore.html">PianoScore</a></li><li><a href="module-@bldr_songbook-intermediate-files-Song.html">Song</a></li><li><a href="module-@bldr_songbook-intermediate-files-SongMetaData.html">SongMetaData</a></li><li><a href="module-@bldr_songbook-intermediate-files-Sqlite.html">Sqlite</a></li><li><a href="module-@bldr_songbook-intermediate-files-TextFile.html">TextFile</a></li><li><a href="module-@bldr_vue-app-presentation_masters-Masters.html">Masters</a></li><li><a href="module-@bldr_vue-app-presentation-BodyAttributes.html">BodyAttributes</a></li><li><a href="module-@bldr_vue-app-presentation-CenterVertically.html">CenterVertically</a></li><li><a href="module-@bldr_vue-app-presentation-ContentTheme.html">ContentTheme</a></li><li><a href="module-@bldr_vue-app-presentation-DarkMode.html">DarkMode</a></li><li><a href="module-@bldr_vue-app-presentation-MultipleAttributes.html">MultipleAttributes</a></li><li><a href="module-@bldr_vue-app-presentation-Overflow.html">Overflow</a></li><li><a href="module-@bldr_vue-app-presentation-StyleConfig.html">StyleConfig</a></li><li><a href="module-@bldr_vue-app-presentation-UiTheme.html">UiTheme</a></li><li><a href="module-@bldr_vue-plugin-media.MediaFile.html">MediaFile</a></li><li><a href="module-@bldr_vue-plugin-media-AssetTypes.html">AssetTypes</a></li><li><a href="module-@bldr_vue-plugin-media-Media.html">Media</a></li><li><a href="module-@bldr_vue-plugin-media-Player.html">Player</a></li><li><a href="module-@bldr_vue-plugin-media-PlayList.html">PlayList</a></li><li><a href="module-@bldr_vue-plugin-media-Resolver.html">Resolver</a></li><li><a href="module-@bldr_vue-plugin-media-Sample.html">Sample</a></li><li><a href="module-@bldr_vue-plugin-shortcuts-Shortcuts.html">Shortcuts</a></li><li><a href="Presentation.html">Presentation</a></li><li><a href="RawSlideObject.html">RawSlideObject</a></li><li><a href="RenderData.html">RenderData</a></li><li><a href="Slide.html">Slide</a></li></ul><h3>Global</h3><ul><li><a href="global.html#actions">actions</a></li><li><a href="global.html#collectMusicMetaData">collectMusicMetaData</a></li><li><a href="global.html#convert">convert</a></li><li><a href="global.html#convertCustomMarkup">convertCustomMarkup</a></li><li><a href="global.html#convertMarkdown">convertMarkdown</a></li><li><a href="global.html#convertOneFile">convertOneFile</a></li><li><a href="global.html#createMetaDataYaml">createMetaDataYaml</a></li><li><a href="global.html#createPresentationTemplate">createPresentationTemplate</a></li><li><a href="global.html#getType">getType</a></li><li><a href="global.html#intersect">intersect</a></li><li><a href="global.html#markupToHtml">markupToHtml</a></li><li><a href="global.html#mirrorRelPath">mirrorRelPath</a></li><li><a href="global.html#mutations">mutations</a></li><li><a href="global.html#naturalSort">naturalSort</a></li><li><a href="global.html#openBasePath">openBasePath</a></li><li><a href="global.html#openFile">openFile</a></li><li><a href="global.html#openFiles">openFiles</a></li><li><a href="global.html#parseSlidesRecursive">parseSlidesRecursive</a></li><li><a href="global.html#rename">rename</a></li><li><a href="global.html#renameOneFile">renameOneFile</a></li><li><a href="global.html#toString">toString</a></li><li><a href="global.html#validateUri">validateUri</a></li><li><a href="global.html#validateYaml">validateYaml</a></li><li><a href="global.html#validateYamlOneFile">validateYamlOneFile</a></li><li><a href="global.html#writeMetaDataYaml">writeMetaDataYaml</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Tue Nov 19 2019 07:54:54 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
