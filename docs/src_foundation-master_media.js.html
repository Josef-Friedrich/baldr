<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/foundation-master/media.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/foundation-master/media.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Filter and resolve the input files used in the presentation.
 * @module @bldr/foundation-master/media
 */

'use strict'

const path = require('path')
const fs = require('fs')
const yaml = require('js-yaml')

/***********************************************************************
 *
 **********************************************************************/

/**
 *
 */
class FileInfo {
  constructor (filePath) {
    /**
     * Absolute path ot the file.
     * @type {string}
     */
    this.path = path.resolve(filePath)

    /**
     * The basename (filename) of the file.
     * @type {string}
     */
    this.basename = path.basename(filePath)

    /**
     * The extension of the file.
     * @type {string}
     */
    this.extension = path.extname(filePath).replace('.', '')
    let info = this.readInfoYaml_()
    for (let property in info) {
      this[property] = info[property]
    }
  }

  /**
   * @type {string}
   */
  get titleSafe () {
    if (this.hasOwnProperty('artist') &amp;&amp; this.hasOwnProperty('title')) {
      return this.artist + ': ' + this.title
    } else if (this.hasOwnProperty('title')) {
      return this.title
    } else {
      return this.basename
    }
  }

  /**
   * Parse the info file of a media file.
   *
   * Each media file can have a info file that stores additional
   * metadata informations.
   *
   * File path:
   * `/home/baldr/beethoven.jpg`
   *
   * Info file in the YAML file format:
   * `/home/baldr/beethoven.jpg.yml`
   */
  readInfoYaml_ () {
    let infoFile = this.path + '.yml'
    if (fs.existsSync(infoFile)) {
      let info = yaml.safeLoad(fs.readFileSync(infoFile, 'utf8'))
      if (typeof info === 'string') {
        return { 'title': info }
      } else {
        return info
      }
    } else {
      return false
    }
  }
}

/***********************************************************************
 *
 **********************************************************************/

/**
 *
 */
class Media {
  /**
   * @param {string} parentPath The path which contains the
   * presentation file (*.baldr).
   */
  constructor (parentPath) {
    /**
     * @type string
     */
    this.parentPath = parentPath

    /**
     * @type Object
     */
    this.types = {
      audio: ['mp3'],
      image: ['jpg', 'jpeg', 'png'],
      video: ['mp4']
    }
  }

  /**
   * Get extensions to filter the input files.
   *
   * @param {array|string} extensions A array of extensions or
   * a single extension specifed as a string or a property of
   * the object “this.types”. An extension should be
   * noted without a leading dot (e. g.: “jpg”, “mp4”)
   *
   * @return {array} A array of extensions
   */
  getExtensions_ (extensions) {
    if (typeof extensions === 'object' &amp;&amp; Array.isArray(extensions)) {
      return extensions
    } else if (
      typeof extensions === 'string' &amp;&amp;
      this.types[extensions]
    ) {
      return this.types[extensions]
    } else if (typeof extensions === 'string') {
      return [extensions]
    } else {
      return []
    }
  }

  /**
   * Get the absolute path of a file used in the presentation.
   *
   * @return {string} Absolute path
   */
  resolvePath_ (filePath) {
    if (path.isAbsolute(filePath)) {
      return filePath
    } else {
      return path.resolve(this.parentPath, filePath)
    }
  }

  /**
   * @param {string} inputPath The path of a file
   * @param {array|string} extensions A array of extensions or
   * a single extension specifed as a string or a property of
   * the object “this.types”. An extension should be
   * noted without a leading dot (e. g.: “jpg”, “mp4”). Leave the
   * parameter empty to bypass the filter mechanism.
   * @return {boolean} True if the input file has the given extension
   */
  filterFile (inputPath, extensions) {
    if (!extensions) {
      return true
    }

    let filterExtensions = this.getExtensions_(extensions)
      .map((value) => {
        return '.' + value.toLowerCase()
      })

    let inputExtension = path.extname(inputPath).toLowerCase()

    for (let filterExtension of filterExtensions) {
      if (inputExtension === filterExtension) return true
    }
    return false
  }

  /**
   * @param {array} fileList An array of file paths
   * @return {object}
   */
  groupByTypes_ (fileList) {
    let out = {}
    for (let type of Object.keys(this.types)) {
      out[type] = fileList.filter(
        /* jshint -W083 */
        file => this.filterFile(file, this.types[type])
      )
        .map(file => new FileInfo(file))
    }
    return out
  }

  /**
   * Scan the parent presentation folder recursively for media files.
   * @return {object}
   * &lt;code>&lt;pre>
   * {
   *   "audio": [
   *     {
   *       "path": "/home/baldr/test/files/media/audio/beethoven.mp3",
   *       "basename": "beethoven.mp3",
   *       "extension": "mp3",
   *       "title": "beethoven.mp3"
   *     }
   *   ],
   *   "image": [
   *     {
   *       "path": "/home/baldr/test/files/media/image/beethoven.jpg",
   *       "basename": "beethoven.jpg",
   *       "extension": "jpg",
   *       "title": "Ludwig van Beethoven",
   *       "profession": "Composer"
   *     },
   *     {
   *       "path": "/home/baldr/test/files/media/image/haydn.jpg",
   *       "basename": "haydn.jpg",
   *       "extension": "jpg",
   *       "title": "Joseph Haydn"
   *     }
   *   ]
   * }
   * &lt;/pre>&lt;/code>
   */
  getMedia () {
    return this.groupByTypes_(
      this.listRecursively_(this.parentPath)
    )
  }

  /**
   * List all files in a directory in Node.js recursively in a
   * synchronous fashion.
   *
   * @param {string} folder Relative or absolute path of a folder.
   * @param {array} fileList An array of file paths
   * @return {array} An array of file paths
   *
   * @see https://gist.github.com/kethinov/6658166
   */
  listRecursively_ (folder, filelist) {
    let files = fs.readdirSync(folder).sort()
    filelist = filelist || []
    files.forEach((file) => {
      let filePath = path.resolve(folder, file)
      if (fs.statSync(filePath).isDirectory()) {
        filelist = this.listRecursively_(filePath, filelist)
      } else {
        filelist.push(filePath)
      }
    })
    return filelist
  }

  /**
   * @param {string} inputPath Relative or absolute path of a folder or
   * a file.
   * @param {array|string} extensions A array of extensions or
   * a single extension specifed as a string or a property of
   * the object “this.types”. An extension should be
   * noted without a leading dot (e. g.: “jpg”, “mp4”). Leave the
   * parameter empty to bypass the filter mechanism.
   * @return {array} A array of absolute file paths or an empty array.
   */
  list (inputPath, extensions) {
    let absPath = this.resolvePath_(inputPath)

    if (!fs.existsSync(absPath)) {
      return []
    }
    let stat = fs.statSync(absPath)
    if (!stat.isDirectory() &amp;&amp; this.filterFile(absPath, extensions)) {
      return [new FileInfo(absPath)]
    } else if (stat.isDirectory()) {
      return this.listRecursively_(absPath)
        .filter((file) => {
          return this.filterFile(file, extensions)
        })
        .map((file) => {
          return new FileInfo(file)
        })
    } else {
      return []
    }
  }

  /**
   * @param {array|string} inputPaths Both folder or file paths can
   * be specified.
   * @param {array|string} extensions A array of extensions or
   * a single extension specifed as a string or a property of
   * the object “this.types”. An extension should be
   * noted without a leading dot (e. g.: “jpg”, “mp4”). Leave the
   * parameter empty to bypass the filter mechanism.
   */
  orderedList (inputPaths, extensions) {
    let normalizedPaths
    if (typeof inputPaths === 'string') {
      normalizedPaths = [inputPaths]
    } else {
      normalizedPaths = inputPaths
    }
    let list = []
    for (let filePath of normalizedPaths) {
      let sortedList = this.list(filePath, extensions)
      for (let file of sortedList) {
        list.push(file)
      }
    }
    return list
  }
}

exports.Media = Media
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-@bldr_core.html">@bldr/core</a></li><li><a href="module-@bldr_core_masters.html">@bldr/core/masters</a></li><li><a href="module-@bldr_core_quick-start.html">@bldr/core/quick-start</a></li><li><a href="module-@bldr_core_slides.html">@bldr/core/slides</a></li><li><a href="module-@bldr_core_slides-switcher.html">@bldr/core/slides-switcher</a></li><li><a href="module-@bldr_core_themes.html">@bldr/core/themes</a></li><li><a href="module-@bldr_foundation-master.html">@bldr/foundation-master</a></li><li><a href="module-@bldr_foundation-master_config.html">@bldr/foundation-master/config</a></li><li><a href="module-@bldr_foundation-master_helper.html">@bldr/foundation-master/helper</a></li><li><a href="module-@bldr_foundation-master_media.html">@bldr/foundation-master/media</a></li><li><a href="module-@bldr_foundation-master_player.html">@bldr/foundation-master/player</a></li><li><a href="module-@bldr_master-audio.html">@bldr/master-audio</a></li><li><a href="module-@bldr_master-camera.html">@bldr/master-camera</a></li><li><a href="module-@bldr_master-editor.html">@bldr/master-editor</a></li><li><a href="module-@bldr_master-image.html">@bldr/master-image</a></li><li><a href="module-@bldr_master-markdown.html">@bldr/master-markdown</a></li><li><a href="module-@bldr_master-person.html">@bldr/master-person</a></li><li><a href="module-@bldr_master-question.html">@bldr/master-question</a></li><li><a href="module-@bldr_master-quote.html">@bldr/master-quote</a></li><li><a href="module-@bldr_master-svg.html">@bldr/master-svg</a></li><li><a href="module-@bldr_master-video.html">@bldr/master-video</a></li><li><a href="module-@bldr_master-website.html">@bldr/master-website</a></li><li><a href="module-@bldr_songbook-base.html">@bldr/songbook-base</a></li><li><a href="module-@bldr_songbook-cli.html">@bldr/songbook-cli</a></li><li><a href="module-@bldr_songbook-electron-app.html">@bldr/songbook-electron-app</a></li><li><a href="module-@bldr_songbook-intermediate-files.html">@bldr/songbook-intermediate-files</a></li><li><a href="module-@bldr_test-helper.html">@bldr/test-helper</a></li><li><a href="module-baldr.html">baldr</a></li><li><a href="module-baldr_render.html">baldr/render</a></li></ul><h3>Classes</h3><ul><li><a href="ModalManager.html">ModalManager</a></li><li><a href="ModalWindowElement.html">ModalWindowElement</a></li><li><a href="module-@bldr_core_masters-Master.html">Master</a></li><li><a href="module-@bldr_core_masters-Masters.html">Masters</a></li><li><a href="module-@bldr_core_quick-start-QuickStart.html">QuickStart</a></li><li><a href="module-@bldr_core_quick-start-QuickStartEntry.html">QuickStartEntry</a></li><li><a href="module-@bldr_core_slides-switcher-SlidesSwitcher.html">SlidesSwitcher</a></li><li><a href="module-@bldr_core_slides-Slide.html">Slide</a></li><li><a href="module-@bldr_core_slides-SlideData.html">SlideData</a></li><li><a href="module-@bldr_core_slides-Slides.html">Slides</a></li><li><a href="module-@bldr_core_slides-StepSwitcher.html">StepSwitcher</a></li><li><a href="module-@bldr_core_themes-Themes.html">Themes</a></li><li><a href="module-@bldr_core-Environment.html">Environment</a></li><li><a href="module-@bldr_core-ShowRunner.html">ShowRunner</a></li><li><a href="module-@bldr_foundation-master_config-Config.html">Config</a></li><li><a href="module-@bldr_foundation-master_media-FileInfo.html">FileInfo</a></li><li><a href="module-@bldr_foundation-master_media-Media.html">Media</a></li><li><a href="module-@bldr_foundation-master_player-Player.html">Player</a></li><li><a href="module-@bldr_master-audio-Audio.html">Audio</a></li><li><a href="module-@bldr_master-video-VideoPlayer.html">VideoPlayer</a></li><li><a href="module-@bldr_songbook-base-AlphabeticalSongsTree.html">AlphabeticalSongsTree</a></li><li><a href="module-@bldr_songbook-base-Folder.html">Folder</a></li><li><a href="module-@bldr_songbook-base-Library.html">Library</a></li><li><a href="module-@bldr_songbook-base-Song.html">Song</a></li><li><a href="module-@bldr_songbook-base-SongMetaData.html">SongMetaData</a></li><li><a href="module-@bldr_songbook-base-SongMetaDataCombined.html">SongMetaDataCombined</a></li><li><a href="module-@bldr_songbook-intermediate-files-FileMonitor.html">FileMonitor</a></li><li><a href="module-@bldr_songbook-intermediate-files-IntermediateLibrary.html">IntermediateLibrary</a></li><li><a href="module-@bldr_songbook-intermediate-files-IntermediateSong.html">IntermediateSong</a></li><li><a href="module-@bldr_songbook-intermediate-files-PianoFilesCountTree.html">PianoFilesCountTree</a></li><li><a href="module-@bldr_songbook-intermediate-files-PianoScore.html">PianoScore</a></li><li><a href="module-@bldr_songbook-intermediate-files-Sqlite.html">Sqlite</a></li><li><a href="module-@bldr_songbook-intermediate-files-TextFile.html">TextFile</a></li><li><a href="module-@bldr_test-helper-Spectron.html">Spectron</a></li><li><a href="PackageElectronApp.html">PackageElectronApp</a></li><li><a href="Seats.html">Seats</a></li><li><a href="SongbookSearchElement.html">SongbookSearchElement</a></li><li><a href="SongSlideElement.html">SongSlideElement</a></li><li><a href="TableOfContentsElement.html">TableOfContentsElement</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bindButtons">bindButtons</a></li><li><a href="global.html#bindShortcuts">bindShortcuts</a></li><li><a href="global.html#defineCustomElements">defineCustomElements</a></li><li><a href="global.html#fakeSong">fakeSong</a></li><li><a href="global.html#fakeSongs">fakeSongs</a></li><li><a href="global.html#main">main</a></li><li><a href="global.html#read">read</a></li><li><a href="global.html#readPathSegments">readPathSegments</a></li><li><a href="global.html#removeANSI">removeANSI</a></li><li><a href="global.html#setNextSong">setNextSong</a></li><li><a href="global.html#setPreviousSong">setPreviousSong</a></li><li><a href="global.html#setRandomSong">setRandomSong</a></li><li><a href="global.html#showByHash">showByHash</a></li><li><a href="global.html#tmpCopy">tmpCopy</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a>.
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
