<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: electron-render.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: electron-render.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Render process, assemble all submodules, bootstrap
 * configuration and run render process
 */

/* global HTMLElement location customElements search */

const jquery = require('jquery')
const mousetrap = require('mousetrap')
const path = require('path')
const { bootstrapConfig, Library, AlphabeticalSongsTree } = require('./src/lib.js')
require('selectize')
const config = bootstrapConfig()
const library = new Library(config.path)

let modalManager

const song = require('./src/song.js')

/**
 * Map some keyboard shortcuts to the corresponding methods.
 */
function bindShortcuts (shortcuts) {
  for (let shortcut in shortcuts) {
    mousetrap.bind(shortcut, shortcuts[shortcut])
  }
}

/**
 * Map some buttons to the corresponding methods.
 */
function bindButtons () {
  let bindings = [
    { selector: '#menu #menu-search', function: () => { modalManager.openByID('search') } },
    { selector: '#menu #menu-tableofcontents', function: () => { modalManager.openByID('tableofcontents') } }
    // { selector: '#slide #previous', function: song.previousSlide },
    // { selector: '#slide #next', function: song.nextSlide }
  ]
  for (let binding of bindings) {
    document
      .querySelector(binding.selector)
      .addEventListener('click', binding.function)
  }
}

let showByHash = function () {
  if (location.hash === '#search') {
    modalManager.openByID('search')
  } else if (location.hash === '#tableofcontents') {
    modalManager.openByID('tableofcontents')
  } else if (location.hash) {
    song.loadByHash()
  } else {
    modalManager.openByID('search')
  }
}

/**
 * Generate a tree view for the table of contents page.
 */
class BaldrSongbookToc extends HTMLElement {
  constructor () {
    super()
    let topUl = document.createElement('ul')

    let tree = new AlphabeticalSongsTree(library.toArray())

    Object.keys(tree).forEach((abc) => {
      let abcLi = document.createElement('li')
      abcLi.setAttribute('class', 'abc')
      abcLi.innerHTML = abc

      let abcUl = document.createElement('ul')

      for (let song of tree[abc]) {
        let li = document.createElement('li')
        let a = document.createElement('a')
        a.setAttribute('href', '#' + song.songID)
        a.setAttribute('id', 'song_' + song.songID)
        a.innerHTML = song.metaDataCombined.title
        li.appendChild(a)
        abcUl.appendChild(li)
      }

      topUl.appendChild(abcLi)
      abcLi.appendChild(abcUl)
    })
    this.appendChild(topUl)
  }
}

/**
 * Build the drop down menu for selectize
 */
class BaldrSongbookSearch extends HTMLElement {
  constructor () {
    super()

    let select = document.createElement('select')
    select.setAttribute('id', 'select')
    select.setAttribute('placeholder', 'Suche nach einem Lied')

    let option = document.createElement('option')
    option.setAttribute('value', '')
    select.appendChild(option)

    for (let songID in library.songs) {
      let song = library.songs[songID]
      option = document.createElement('option')
      option.setAttribute('value', songID)
      option.innerHTML = song.metaDataCombined.title
      select.appendChild(option)
    }
    this.appendChild(select)
  }
}

/**
 * Build the drop down menu for selectize
 */
class BaldrSongbookModal extends HTMLElement {
  constructor () {
    super()
    let elmementClose = document.createElement('div')
    elmementClose.addEventListener('click', () => { this.close() })
    elmementClose.classList.add('close', 'button', 'fa', 'fa-times')
    if (this.hasAttribute('title')) {
      let elementH2 = document.createElement('h2')
      elementH2.innerHTML = this.getAttribute('title')
      this.prepend(elementH2)
    }
    this.prepend(elmementClose)
    this.style.display = 'none'
  }

  close () {
    this.style.display = 'none'
  }

  get isOpen () {
    if (this.style.display === 'none') {
      return false
    } else if (this.style.display === 'block') {
      return true
    }
  }

  open () {
    this.style.display = 'block'
  }

  toggle () {
    if (this.style.display === 'none') {
      this.style.display = 'block'
    } else {
      this.style.display = 'none'
    }
  }
}

/**
 *
 */
class BaldrSongbookSongSlide extends HTMLElement {
  static get observedAttributes() {
    return ['songid', 'no']
  }

  constructor () {
    super()
    const shadowRoot = this.attachShadow({mode: 'open'})

    let styleElement = document.createElement('style')
    styleElement.innerHTML = `
      div {
        max-width: 100%;
        max-height: 100%;
        text-align: center;
      }

      img {
        width: 100%;
        height: 100%;
        vertical-align: middle;
        background-color: white;
      }
    `
    shadowRoot.appendChild(styleElement)

    let divElement = document.createElement('div')
    shadowRoot.appendChild(divElement)

    /**
     *
     */
    this.imgElement = document.createElement('img')
    divElement.appendChild(this.imgElement)

    /**
     * The song object
     * @type {module:baldr-songbook~lib.Song}
     */
    this.song

    /**
     * The current slide number. The lowest slide number is 1 not 0.
     */
    this.no = 1
  }

  attributeChangedCallback (name, oldValue, newValue) {
    if (name === 'songid') {
      this.setSongById_(newValue)
    } else if (name === 'no') {
      this.setSlideByNo_(newValue)
    }
  }

  setSongById_ (songID) {
    this.song = library.getSongById(songID)
  }

  setSongByHash (hash) {
    if (hash !== '') {
      this.setSongById_(hash.substring(1))
    }
  }

  setSlideByNo_ (no) {
    this.imgElement.setAttribute('src', path.join(this.song.folderSlides.get(), this.song.slidesFiles[no - 1]))
  }

  get no () {
    return this.no_
  }

  set no (value) {
    this.no_ = value
    this.setAttribute('no', value)
  }

  /**
   * Show the next slide.
   */
  next () {
    if (this.no === this.song.slidesFiles.length) {
      this.no = 1
    } else {
      this.no += 1
    }
    this.setSlideByNo_(this.no)
  }

  /**
   * Show the previous slide.
   */
  previous () {
    if (this.no === 1) {
      this.no = this.song.slidesFiles.length
    } else {
      this.no -= 1
    }
    this.setSlideByNo_(this.no)
  }
}

/**
 * Manage all modal windows of a app.
 */
class ModalManager {
  constructor () {
    let modals = document.querySelectorAll('baldr-songbook-modal')
    this.modals = {}
    for (let modal of modals) {
      this.modals[modal.id] = modal
    }
  }

  toggleByID (modalID) {
    this.modals[modalID].open()
  }

  closeAll () {
    for (let modalID in this.modals) {
      this.modals[modalID].close()
    }
  }

  openByID (modalID) {
    for (let id in this.modals) {
      let modal = this.modals[id]
      if (modal.id === modalID) {
        modal.open()
      } else {
        modal.close()
      }
    }
  }
}

let main = function () {
  customElements.define('baldr-songbook-search', BaldrSongbookSearch)
  customElements.define('baldr-songbook-toc', BaldrSongbookToc)
  customElements.define('baldr-songbook-modal', BaldrSongbookModal)
  customElements.define('baldr-songbook-song-slide', BaldrSongbookSongSlide)

  let songSlide = document.querySelector('baldr-songbook-song-slide')
  modalManager = new ModalManager()

  song.set({
    'library': library.list,
    'selector': '#slide img',
    'songsPath': config.path
  })

  bindButtons()

  window.onhashchange = showByHash

  bindShortcuts({
    'left': function () { songSlide.previous() },
    'right': function () { songSlide.next() },
    'esc': function () { modalManager.toggleByID('search') },
    'alt': function () { modalManager.toggleByID('tableofcontents') }
  })

  let selectized = jquery('select').selectize({
    onItemAdd: function (value, data) {
      song.setCurrent(value)
      modalManager.closeAll()
    }
  })
  search.selectize = selectized[0].selectize
  search.selectize.focus()

  showByHash()
}

if (config.path) {
  main()
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-baldr-songbook.html">baldr-songbook</a></li></ul><h3>Classes</h3><ul><li><a href="AlphabeticalSongsTree.html">AlphabeticalSongsTree</a></li><li><a href="BaldrSongbookModal.html">BaldrSongbookModal</a></li><li><a href="BaldrSongbookSearch.html">BaldrSongbookSearch</a></li><li><a href="BaldrSongbookSongSlide.html">BaldrSongbookSongSlide</a></li><li><a href="BaldrSongbookToc.html">BaldrSongbookToc</a></li><li><a href="FileMonitor.html">FileMonitor</a></li><li><a href="Folder.html">Folder</a></li><li><a href="Library.html">Library</a></li><li><a href="ModalManager.html">ModalManager</a></li><li><a href="PianoFilesCountTree.html">PianoFilesCountTree</a></li><li><a href="PianoScore.html">PianoScore</a></li><li><a href="Song.html">Song</a></li><li><a href="SongMetaData.html">SongMetaData</a></li><li><a href="SongMetaDataCombined.html">SongMetaDataCombined</a></li><li><a href="Sqlite.html">Sqlite</a></li><li><a href="TextFile.html">TextFile</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bindButtons">bindButtons</a></li><li><a href="global.html#bindShortcuts">bindShortcuts</a></li><li><a href="global.html#bootstrapConfig">bootstrapConfig</a></li><li><a href="global.html#checkExecutable">checkExecutable</a></li><li><a href="global.html#checkExecutables">checkExecutables</a></li><li><a href="global.html#folder">folder</a></li><li><a href="global.html#library">library</a></li><li><a href="global.html#loadByHash">loadByHash</a></li><li><a href="global.html#main">main</a></li><li><a href="global.html#nextSlide">nextSlide</a></li><li><a href="global.html#parseCliArguments">parseCliArguments</a></li><li><a href="global.html#previousSlide">previousSlide</a></li><li><a href="global.html#setCurrent">setCurrent</a></li><li><a href="global.html#setSlide">setSlide</a></li><li><a href="global.html#setSongTitle">setSongTitle</a></li><li><a href="global.html#slideNumber">slideNumber</a></li><li><a href="global.html#slideNumberMax">slideNumberMax</a></li><li><a href="global.html#slides">slides</a></li><li><a href="global.html#song">song</a></li><li><a href="global.html#songsPath">songsPath</a></li><li><a href="global.html#sortObjectsByProperty">sortObjectsByProperty</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a>.
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
