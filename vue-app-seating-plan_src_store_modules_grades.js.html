<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: vue-app-seating-plan/src/store/modules/grades.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: vue-app-seating-plan/src/store/modules/grades.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Sort alphabetically
 */

import Vue from 'vue'

class Grade {
  constructor (name) {
    this.name = name
    this.persons = {}
  }

  toJSON () {
    return this.persons
  }
}

export class Person {
  constructor (firstName, lastName, grade, seatNo = 0, jobs = []) {
    this.firstName = firstName.trim()
    this.lastName = lastName.trim()
    this.grade = grade.trim()
    this.seatNo = seatNo
    this.jobs = jobs
  }

  get name () {
    return `${this.lastName}, ${this.firstName}`
  }

  get id () {
    return `${this.grade}: ${this.lastName}, ${this.firstName}`
  }

  toJSON () {
    const json = {
      // firstName: this.firstName,
      // lastName: this.lastName,
      // grade: this.grade
    }
    if (this.seatNo) json.seatNo = this.seatNo
    if (this.jobs.length) json.jobs = this.jobs
    return json
  }

  splitName (name) {
    const segments = name.split(', ')
    return {
      firstName: segments[1],
      lastName: segments[0]
    }
  }
}

/**
 * @see {@link https://stackoverflow.com/a/38641281}
 */
function naturalSort (a, b) {
  return a.localeCompare(b, 'de', { numeric: true, sensitivity: 'base' })
}

const state = {}

const getters = {
  grade: (state) => (gradeName) => {
    if ({}.hasOwnProperty.call(state, gradeName)) {
      return state[gradeName]
    }
    return false
  },
  gradeCurrent: (state, getters) => {
    const gradeName = getters.gradeNameCurrent
    if (gradeName) {
      return getters.grade(gradeName)
    }
  },
  gradeNames: (state) => {
    const gradeNames = Object.keys(state)
    return gradeNames.sort(naturalSort)
  },
  gradeOfPerson: (state, getters) => (person) => {
    return getters.grade(person.grade)
  },
  hasPersonJob: (state, getters) => (personId, jobName) => {
    if (!personId) {
      return false
    }
    const person = getters.personById(personId)
    return person.jobs.includes(jobName)
  },
  isGradePlaced: (state, getters) => (gradeName) => {
    if (getters.personsCount(gradeName) === getters.personsPlacedCount(gradeName)) {
      return true
    }
    return false
  },
  isGradePlacedCurrent: (state, getters) => {
    return getters.isGradePlaced(getters.gradeNameCurrent)
  },
  jobsOfGrade: (state, getters) => (gradeName) => {
    const persons = getters.personsByGrade(gradeName)
    const jobs = {}
    for (const [personName, person] of Object.entries(persons)) {
      if (person.jobs) {
        for (const jobName of person.jobs) {
          if (!{}.hasOwnProperty.call(jobs, jobName)) {
            jobs[jobName] = {}
          }
          jobs[jobName][personName] = person
        }
      }
    }
    return jobs
  },
  jobsOfGradeCurrent: (state, getters) => {
    return getters.jobsOfGrade(getters.gradeNameCurrent)
  },
  jobsOfPerson: (state, getters) => (person) => {
    return person.jobs
  },
  person: (state) => ({ firstName, lastName, grade }) => {
    const name = `${lastName}, ${firstName}`
    if ({}.hasOwnProperty.call(state, grade) &amp;&amp;
        {}.hasOwnProperty.call(state[grade].persons, name)) {
      return state[grade].persons[name]
    }
    return false
  },
  personByGradeAndSeatNo: (state, getters) => (gradeName, seatNo) => {
    const persons = getters.personsByGrade(gradeName)
    for (const personName in persons) {
      const person = persons[personName]
      if (seatNo === person.seatNo) return person
    }
    return false
  },
  personByGradeAndSeatNoCurrent: (state, getters) => (seatNo) => {
    const gradeName = getters.gradeNameCurrent
    return getters.personByGradeAndSeatNo(gradeName, seatNo)
  },
  personById: (state, getters) => (personId) => {
    const match = personId.match(/(.+): (.+), (.+)/)
    return getters.person({
      firstName: match[3],
      lastName: match[2],
      grade: match[1]
    })
  },
  personsByGrade: (state) => (gradeName) => {
    if ({}.hasOwnProperty.call(state, gradeName)) {
      return state[gradeName].persons
    }
    return {}
  },
  personsByGradeAsListSortedCurrent: (state, getters) => {
    const persons = getters.personsByGrade(getters.gradeNameCurrent)
    const out = []
    if (persons) {
      for (const name of Object.keys(persons).sort()) {
        out.push(persons[name])
      }
      return out
    }
    return []
  },
  personsByGradeCurrent: (state, getters) => {
    return getters.personsByGrade(getters.gradeNameCurrent)
  },
  personsCount: (state, getters) => (gradeName) => {
    const persons = getters.personsByGrade(gradeName)
    return Object.keys(persons).length
  },
  personsCountCurrent: (state, getters) => {
    return getters.personsCount(getters.gradeNameCurrent)
  },
  personsPlacedCount: (state, getters) => (gradeName) => {
    const persons = getters.personsByGrade(gradeName)
    let count = 0
    for (const personName in persons) {
      if (persons[personName].seatNo) {
        count += 1
      }
    }
    return count
  },
  personsPlacedCountCurrent: (state, getters) => {
    return getters.personsPlacedCount(getters.gradeNameCurrent)
  }
}

/**
 * Naming convention:
 *
 * CRUD:
 * - create
 * - delete
 */
const actions = {
  addJobToPerson: ({ commit, getters }, { personId, jobName }) => {
    if (!getters.hasPersonJob(personId, jobName)) {
      const person = getters.personById(personId)
      const job = getters.jobByName(jobName)
      commit('addJobToPerson', { person, job })
    }
  },
  createGrade: ({ commit, getters }, gradeName) => {
    if (!getters.grade(gradeName)) {
      const grade = new Grade(gradeName)
      commit('createGrade', grade)
    }
  },
  createPerson: ({ commit, getters, dispatch }, { firstName, lastName, grade, seatNo, jobs }) => {
    if (!getters.person({ firstName, lastName, grade })) {
      const person = new Person(firstName, lastName, grade, seatNo, jobs)
      dispatch('createGrade', person.grade)
      commit('createPerson', person)
    }
  },
  deleteGrade: ({ commit }, gradeName) => {
    commit('deleteGrade', gradeName)
  },
  deletePerson: ({ commit }, person) => {
    commit('deletePerson', person)
  },
  importGradesState: ({ dispatch, commit }, newState) => {
    commit('flushGradesState')
    for (const gradeName in newState) {
      for (const personName in newState[gradeName]) {
        const name = Person.prototype.splitName(personName)
        const person = newState[gradeName][personName]
        dispatch('createPerson', {
          firstName: name.firstName,
          lastName: name.lastName,
          grade: gradeName,
          seatNo: person.seatNo,
          jobs: person.jobs
        })
      }
    }
  },
  placePerson: ({ commit, getters }, { seatNo, personId }) => {
    const oldPerson = getters.personByGradeAndSeatNoCurrent(seatNo)
    const newPerson = getters.personById(personId)

    // Drag the same placed person over the same seat
    if (oldPerson &amp;&amp; oldPerson.id === newPerson.id) {
      return
    }

    if (oldPerson) {
      commit('unplacePerson', { person: oldPerson })
    }

    // Move the same person to another seat. Free the previously taken seat.
    if (newPerson.seatNo) {
      commit('unplacePerson', { person: newPerson })
    }

    // Place the person.
    commit('placePerson', { person: newPerson, seatNo: seatNo })
  },
  removeJobFromPerson: ({ commit, getters }, { personId, jobName }) => {
    const person = getters.personById(personId)
    const job = getters.jobByName(jobName)
    commit('removeJobFromPerson', { person, job })
  },
  unplacePerson: ({ commit, getters }, { personId, seatNo }) => {
    const person = getters.personById(personId)
    const seat = getters.seatByNo(seatNo)
    commit('unplacePerson', { person, seat })
  }
}

/**
 * Naming convention:
 *
 * CRUD:
 * - create
 * - delete
 */
const mutations = {
  addJobToPerson: (state, { person, job }) => {
    person.jobs.push(job.name)
  },
  createGrade: (state, grade) => {
    Vue.set(state, grade.name, grade)
  },
  createPerson: (state, person) => {
    Vue.set(state[person.grade].persons, person.name, person)
  },
  deleteGrade: (state, gradeName) => {
    Vue.delete(state, gradeName)
  },
  deletePerson: (state, person) => {
    Vue.delete(state[person.grade].persons, person.name)
  },
  flushGradesState: (state) => {
    for (const property of Object.keys(state)) {
      delete state[property]
    }
  },
  placePerson: (state, { person, seatNo }) => {
    person.seatNo = seatNo
  },
  removeJobFromPerson: (state, { person, job }) => {
    for (let i = 0; i &lt; person.jobs.length; i++) {
      if (person.jobs[i] === job.name) {
        person.jobs.splice(i, 1)
        break
      }
    }
  },
  renameGrade: (state, { oldGradeName, newGradeName }) => {
    if (oldGradeName === newGradeName || !newGradeName) return
    const persons = state[oldGradeName].persons
    for (const personName in persons) {
      persons[personName].grade = newGradeName
    }
    Vue.set(state, newGradeName, state[oldGradeName])
    Vue.delete(state, oldGradeName)
  },
  renamePerson: (state, { person, newFirstName, newLastName }) => {
    const oldName = person.name
    if (newFirstName) person.firstName = newFirstName
    if (newLastName) person.lastName = newLastName
    const newName = person.name
    if (oldName === newName) return
    Vue.set(state[person.grade].persons, newName, person)
    Vue.delete(state[person.grade].persons, oldName)
  },
  unplacePerson: (state, { person }) => {
    person.seatNo = 0
  }
}

export default {
  state,
  getters,
  actions,
  mutations
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-@bldr_api.html">@bldr/api</a></li><li><a href="module-@bldr_api-media-server.html">@bldr/api-media-server</a></li><li><a href="module-@bldr_api-seating-plan.html">@bldr/api-seating-plan</a></li><li><a href="module-@bldr_core-browser.html">@bldr/core-browser</a></li><li><a href="module-@bldr_core-node.html">@bldr/core-node</a></li><li><a href="module-@bldr_http-request.html">@bldr/http-request</a></li><li><a href="module-@bldr_songbook-cli.html">@bldr/songbook-cli</a></li><li><a href="module-@bldr_songbook-core.html">@bldr/songbook-core</a></li><li><a href="module-@bldr_songbook-intermediate-files.html">@bldr/songbook-intermediate-files</a></li><li><a href="module-@bldr_themes.html">@bldr/themes</a></li><li><a href="module-@bldr_vue-app-presentation.html">@bldr/vue-app-presentation</a></li><li><a href="module-@bldr_vue-app-presentation_masters.html">@bldr/vue-app-presentation/masters</a></li><li><a href="module-@bldr_vue-app-seating-plan.html">@bldr/vue-app-seating-plan</a></li><li><a href="module-@bldr_vue-app-showroom.html">@bldr/vue-app-showroom</a></li><li><a href="module-@bldr_vue-app-songbook.html">@bldr/vue-app-songbook</a></li><li><a href="module-@bldr_vue-plugin-components-collection.html">@bldr/vue-plugin-components-collection</a></li><li><a href="module-@bldr_vue-plugin-material-icon.html">@bldr/vue-plugin-material-icon</a></li><li><a href="module-@bldr_vue-plugin-media.html">@bldr/vue-plugin-media</a></li><li><a href="module-@bldr_vue-plugin-shortcuts.html">@bldr/vue-plugin-shortcuts</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-@bldr_vue-app-presentation-Vue.html">Vue</a></li></ul><h3>Classes</h3><ul><li><a href="InitState.html">InitState</a></li><li><a href="module-@bldr_api-media-server-Asset.html">Asset</a></li><li><a href="module-@bldr_api-media-server-MediaFile.html">MediaFile</a></li><li><a href="module-@bldr_http-request.HttpRequest.html">HttpRequest</a></li><li><a href="module-@bldr_songbook-core-AlphabeticalSongsTree.html">AlphabeticalSongsTree</a></li><li><a href="module-@bldr_songbook-core-CoreLibrary.html">CoreLibrary</a></li><li><a href="module-@bldr_songbook-core-SongMetaDataCombined.html">SongMetaDataCombined</a></li><li><a href="module-@bldr_songbook-intermediate-files-FileMonitor.html">FileMonitor</a></li><li><a href="module-@bldr_songbook-intermediate-files-Folder.html">Folder</a></li><li><a href="module-@bldr_songbook-intermediate-files-IntermediateLibrary.html">IntermediateLibrary</a></li><li><a href="module-@bldr_songbook-intermediate-files-IntermediateSong.html">IntermediateSong</a></li><li><a href="module-@bldr_songbook-intermediate-files-Library.html">Library</a></li><li><a href="module-@bldr_songbook-intermediate-files-PianoFilesCountTree.html">PianoFilesCountTree</a></li><li><a href="module-@bldr_songbook-intermediate-files-PianoScore.html">PianoScore</a></li><li><a href="module-@bldr_songbook-intermediate-files-Song.html">Song</a></li><li><a href="module-@bldr_songbook-intermediate-files-SongMetaData.html">SongMetaData</a></li><li><a href="module-@bldr_songbook-intermediate-files-Sqlite.html">Sqlite</a></li><li><a href="module-@bldr_songbook-intermediate-files-TextFile.html">TextFile</a></li><li><a href="module-@bldr_vue-app-presentation_masters-Master.html">Master</a></li><li><a href="module-@bldr_vue-app-presentation_masters-Masters.html">Masters</a></li><li><a href="module-@bldr_vue-app-presentation-BodyAttributes.html">BodyAttributes</a></li><li><a href="module-@bldr_vue-app-presentation-CenterVertically.html">CenterVertically</a></li><li><a href="module-@bldr_vue-app-presentation-ContentTheme.html">ContentTheme</a></li><li><a href="module-@bldr_vue-app-presentation-DarkMode.html">DarkMode</a></li><li><a href="module-@bldr_vue-app-presentation-MultipleAttributes.html">MultipleAttributes</a></li><li><a href="module-@bldr_vue-app-presentation-Overflow.html">Overflow</a></li><li><a href="module-@bldr_vue-app-presentation-StyleConfig.html">StyleConfig</a></li><li><a href="module-@bldr_vue-app-presentation-UiTheme.html">UiTheme</a></li><li><a href="module-@bldr_vue-plugin-media.MediaFile.html">MediaFile</a></li><li><a href="module-@bldr_vue-plugin-media-Media.html">Media</a></li><li><a href="module-@bldr_vue-plugin-media-MediaTypes.html">MediaTypes</a></li><li><a href="module-@bldr_vue-plugin-media-Player.html">Player</a></li><li><a href="module-@bldr_vue-plugin-media-PlayList.html">PlayList</a></li><li><a href="module-@bldr_vue-plugin-media-Resolver.html">Resolver</a></li><li><a href="module-@bldr_vue-plugin-media-Sample.html">Sample</a></li><li><a href="module-@bldr_vue-plugin-shortcuts-Shortcuts.html">Shortcuts</a></li><li><a href="Presentation.html">Presentation</a></li><li><a href="RawSlideObject.html">RawSlideObject</a></li><li><a href="RenderData.html">RenderData</a></li><li><a href="Slide.html">Slide</a></li></ul><h3>Global</h3><ul><li><a href="global.html#actions">actions</a></li><li><a href="global.html#getType">getType</a></li><li><a href="global.html#intersect">intersect</a></li><li><a href="global.html#mutations">mutations</a></li><li><a href="global.html#naturalSort">naturalSort</a></li><li><a href="global.html#openFile">openFile</a></li><li><a href="global.html#openFiles">openFiles</a></li><li><a href="global.html#toString">toString</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Tue Oct 29 2019 14:38:01 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
